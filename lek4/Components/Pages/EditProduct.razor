@page "/edit-product/{productNumber:int}"
@using lek4.Components.Service

@inject NavigationManager NavigationManager
@inject lek4.Components.Service.ProductService ProductService

<h3>Edit Product @productNumber</h3>

<div class="edit-product-form">
    <label for="price">Price</label>
    <input type="number" id="price" min="0" step="0.1" @bind="price" />

    <label for="lockInAmount">Lock-in Amount</label>
    <input type="number" id="lockInAmount" min="0" step="0.1" @bind="lockInAmount" />

    <label for="userEmail">User Email</label>
    <input type="email" id="userEmail" @bind="userEmail" />

    <button @onclick="SaveChanges">Save Changes</button>
</div>

@code {
    [Parameter]
    public int productNumber { get; set; }

    private double price;
    private double lockInAmount;
    private string userEmail;
    private ProductService.ProductData productData; // Holds the product data

    protected override async Task OnInitializedAsync()
    {
        // Fetch the product data from Firebase
        productData = await ProductService.GetProductFromFirebaseAsync(productNumber);

        if (productData != null)
        {
            // Set local values for price, lockInAmount, and userEmail based on the fetched data
            price = productData.Price;
            lockInAmount = productData.LockInAmount;
            userEmail = productData.UserEmail;
        }
        else
        {
            // Handle if the product does not exist
            Console.WriteLine("Product not found.");
            NavigationManager.NavigateTo("/change-products"); // Redirect back
        }
    }
    private async Task SaveChanges()
    {
        // Update the product data with new values
        if (productData != null)
        {
            // Update productData object with the new values from the form
            productData.Price = price;
            productData.LockInAmount = lockInAmount;
            productData.UserEmail = userEmail;

            // Assuming you need to define a userId, you can either generate it or provide a value
            int userId = 1; // You can set this to any unique value for the user

            // Use the existing SaveProductData method to save the updated product info
            await ProductService.SaveProductData(productNumber, userEmail, lockInAmount, price);

            // Save the user data with a unique userId
            await ProductService.SaveUserToProduct(productNumber, userId, productData);

            // After saving, navigate back to the products list
            NavigationManager.NavigateTo("/change-products");
        }
    }
}
